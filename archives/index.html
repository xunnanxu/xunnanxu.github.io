
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Shawn&#39;s Pitstop">
    <title>Archives - Shawn&#39;s Pitstop</title>
    <meta name="author" content="Shawn Xu">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Shawn&#39;s Pitstop">
<meta property="og:url" content="https://xunnanxu.github.io/archives/index.html">
<meta property="og:site_name" content="Shawn&#39;s Pitstop">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Shawn Xu">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-yvywglw62lgxwz25dsjvepo05oagkygdd7st7xfdzhmmxwqoijtiy3ngabtp.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83953865-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-83953865-1');
    </script>


    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/%20"
            aria-label=""
        >
            Shawn&#39;s Pitstop
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg" alt="Author&#39;s picture"/>
        
        </a>
    
    <script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';</script>
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Shawn Xu</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Software Engineer in Bay Area</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/xunnanxu"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2025/09/01/Journey-to-enable-M1-pro-single-thunderbolt/"
                            aria-label=": The Spec Mess: Journey to Enable M1 Pro + 2 2K-monitors @ 100Hz over One Single Thunderbolt Cable"
                        >
                            The Spec Mess: Journey to Enable M1 Pro + 2 2K-monitors @ 100Hz over One Single Thunderbolt Cable
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-09-01T16:44:36-07:00">
	
		    Sep 01, 2025
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>Recently I’ve been looking into giving my WFH setup some upgrade.<br>
I already have a 38inch AW3821DW monitor running <strong>3800x1600 @ 144Hz</strong>, connected to the <strong>M1 Pro Macbook Pro</strong> via a <strong>TB3 dock</strong> (StarTech TB3DOCK2DPPD that I bought years ago pre-pandemic). I’m trying to add a side monitor to it with likely a QHD spec <strong>(2560x1440) @ 100Hz</strong>.</p>
<div class="mermaid">
  graph TD;
    M1[M1 Pro]-->TBDock[TB Dock]
    TBDock-->AW3821DW[AW3821DW 3800x1600 @ 144Hz]
    TBDock-->QHD[QHD 2560x1440 @ 100Hz]
</div>

<p>Then I suddenly realized one thing, if I want to keep my connection topology as is (wire up all devices to my dock and connect it to the Mac using a single TB cable) - would that work?</p>
<p>It turns out it’s not that straightforward to average users. And here’s why.</p>
<hr>
<h2 id="1)-rgb-4%3A4%3A4-vs-ycbcr-4%3A2%3A2-chroma-subsampling" tabindex="-1">1) RGB 4:4:4 vs YCbCr 4:2:2 Chroma Subsampling</h2>
<p>Before doing math, we first need to check the <em>signal</em> we want to drive:</p>
<ul>
<li><strong>RGB/YCbCr 4:4:4, 8-bit per channel (bpc)</strong> → <strong>24 bits/pixel</strong>. This is the “no-compromise” desktop signal—full chroma on every pixel. Text looks crisp.</li>
<li><strong>YCbCr 4:2:2, 8-bpc</strong> → the chroma (Cb/Cr) is shared between two horizontal pixels, averaging <strong>16 bits/pixel</strong> (≈ 33% less data than 4:4:4). Saves bandwidth, but fine colored edges and UI text soften.</li>
<li><strong>YCbCr 4:2:0, 8-bpc</strong> → <strong>12 bits/pixel</strong> (≈ 50% less than 4:4:4). Great for video, not for desktop use.</li>
<li><strong>HDR / 10-bpc</strong> pushes each of those up by 25% (e.g., RGB 4:4:4 becomes <strong>30 bits/pixel</strong>).</li>
</ul>
<p>For SDR productivity monitors, we should <strong>ALWAYS</strong> prefer <strong>RGB 4:4:4</strong> (or YCbCr 4:4:4) at 8-bpc for clear text.<br>
Anything doing chroma subsampling (422) is a no-go as text would have blurred/colored edges. Period.</p>
<hr>
<h2 id="2)-the-bandwidth-calculation" tabindex="-1">2) The bandwidth calculation</h2>
<p>For uncompressed links (DisplayPort/HDMI without DSC), a solid back-of-the-envelope is:</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mtext mathvariant="bold">Signal</mtext><mtext> </mtext><mtext mathvariant="bold">rate</mtext></mrow><mo>≈</mo><mtext>(Horizontal px)</mtext><mo>×</mo><mtext>(Vertical px)</mtext><mo>×</mo><mtext>(Refresh Hz)</mtext><mo>×</mo><mtext>(bits/pixel)</mtext><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">
\textbf{Signal rate} \approx \text{(Horizontal px)} \times \text{(Vertical px)} \times \text{(Refresh Hz)} \times \text{(bits/pixel)}.
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textbf">Signal rate</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(Horizontal px)</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(Vertical px)</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(Refresh Hz)</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(bits/pixel)</span></span><span class="mord">.</span></span></span></span></span></eqn></section><p>This yields the <strong>active video</strong> payload. Real links also carry blanking intervals and link-layer overhead. Using modern reduced-blanking timings, a <strong>5–10% headroom</strong> usually suffices for comparisons; standards bodies quote separate “link rates” that already include line coding overhead.</p>
<p>Let’s compute the key cases (all at 8-bpc unless noted):</p>
<ul>
<li>
<p><strong>One QHD (2560×1440) @ 100 Hz, 4:4:4</strong><br>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>2560</mn><mo>×</mo><mn>1440</mn><mo>×</mo><mn>100</mn><mo>×</mo><mn>24</mn><mtext>  </mtext><mo>=</mo><mtext>  </mtext><mrow><mn mathvariant="bold">8.85</mn><mtext> </mtext><mi mathvariant="bold">G</mi><mi mathvariant="bold">b</mi><mi mathvariant="bold">p</mi><mi mathvariant="bold">s</mi></mrow></mrow><annotation encoding="application/x-tex">2560 \times 1440 \times 100 \times 24 \;=\; \mathbf{8.85\ Gbps}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2560</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1440</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathbf">8.85</span><span class="mspace"> </span><span class="mord mathbf">Gbps</span></span></span></span></span></span></eqn></section><br>
With 10-bpc (30 bpp): <strong>11.06 Gbps</strong>.<br>
With 4:2:2 (16 bpp): <strong>5.90 Gbps</strong>.</p>
</li>
<li>
<p><strong>Your ultrawide (3840×1600), 4:4:4</strong></p>
<ul>
<li>@ <strong>100 Hz</strong><br>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>3840</mn><mo>×</mo><mn>1600</mn><mo>×</mo><mn>100</mn><mo>×</mo><mn>24</mn><mo>=</mo><mrow><mn mathvariant="bold">14.75</mn><mtext> </mtext><mi mathvariant="bold">G</mi><mi mathvariant="bold">b</mi><mi mathvariant="bold">p</mi><mi mathvariant="bold">s</mi></mrow></mrow><annotation encoding="application/x-tex">3840 \times 1600 \times 100 \times 24 = \mathbf{14.75\ Gbps} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3840</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1600</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathbf">14.75</span><span class="mspace"> </span><span class="mord mathbf">Gbps</span></span></span></span></span></span></eqn></section></li>
<li>@ <strong>120 Hz</strong> <strong>17.69 Gbps</strong> (already nudging past DP 1.2’s effective limit once overhead is considered).</li>
<li>@ <strong>144 Hz</strong>: <strong>21.23 Gbps</strong> (firmly beyond DP 1.2; needs DP 1.4/HBR3 and/or DSC support end-to-end).</li>
</ul>
</li>
<li>
<p><strong>Two monitors together</strong>:</p>
<ul>
<li><strong>3840×1600 @ 100 Hz</strong> + <strong>2560×1440 @ 100 Hz</strong> (both 8-bpc 4:4:4) →<br>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>14.75</mn><mo>+</mo><mn>8.85</mn><mo>≈</mo><mrow><mn mathvariant="bold">23.6</mn><mtext> </mtext><mi mathvariant="bold">G</mi><mi mathvariant="bold">b</mi><mi mathvariant="bold">p</mi><mi mathvariant="bold">s</mi></mrow></mrow><annotation encoding="application/x-tex">14.75 + 8.85 \approx \mathbf{23.6\ Gbps}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">14.75</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8.85</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathbf">23.6</span><span class="mspace"> </span><span class="mord mathbf">Gbps</span></span></span></span></span></span></eqn></section><br>
This is in the same ballpark as <strong>dual 4K60 8-bpc</strong> (≈ 23.9 Gbps active), which many Thunderbolt 3 docks explicitly support.</li>
</ul>
</li>
</ul>
<p><strong>Interpreting against link limits</strong></p>
<ul>
<li><strong>DisplayPort 1.2 (HBR2)</strong>: Max <strong>17.28 Gbps</strong> payload per DP link. One 2560×1440@100 (8-bpc 4:4:4) fits comfortably. One 3840×1600@100 fits. <strong>3840×1600@120 does not</strong>, and @144 certainly does not.</li>
<li><strong>DisplayPort 1.4 (HBR3)</strong>: Max <strong>25.92 Gbps</strong> payload per DP link. Enough for 3840×1600@120/144 uncompressed in many timing modes, or with DSC when needed.</li>
</ul>
<hr>
<h2 id="3)-dp-1.4-vs-dp-1.2%E2%80%94and-how-that-relates-to-thunderbolt-versions" tabindex="-1">3) DP 1.4 vs DP 1.2—and how that relates to Thunderbolt versions</h2>
<ul>
<li><strong>DP 1.2 (HBR2)</strong> tops out at 5.4Gbps/lane x 4 - <strong>21.6 Gbps raw / 17.28 Gbps effective</strong> payload.</li>
<li><strong>DP 1.4 (HBR3)</strong> increases the lane rate to 8.1Gbps/lane -&gt; <strong>32.4 Gbps raw / 25.92 Gbps effective</strong> and adds features like <strong>DSC 1.2</strong> for higher-than-link-rate modes.</li>
<li><strong>Thunderbolt 3</strong> originally shipped on <strong>Alpine Ridge</strong> controllers that <strong>tunnel DP 1.2</strong> only. Later <strong>Titan Ridge</strong> TB3 silicon can <strong>tunnel DP 1.4</strong>.</li>
<li><strong>Thunderbolt 4</strong> is built on <strong>USB4 v1</strong>; it <strong>mandates</strong> support for <strong>two 4K displays or one 8K display</strong>, functionally aligning with <strong>DP 1.4/HBR3</strong> tunneling end-to-end. (TB4 does not raise the nominal 40 Gbps link rate; it raises the <em>minimums</em> OEMs must deliver.)</li>
</ul>
<p>However, the <strong>StarTech TB3DOCK2DPPD</strong> is an older <strong>Alpine Ridge (JHL6540)</strong> design—i.e., <strong>DP 1.2-only</strong> on its display paths. It still handles <strong>dual-display</strong> by presenting <strong>two DP sinks</strong> to the host TB controller (one on the rear DisplayPort jack, and a <strong>downstream TB3 port</strong>). But each DP hop is capped at <strong>DP 1.2</strong> timings.</p>
<hr>
<h2 id="4)-m1-pro-limitations-and-why-a-downstream-thunderbolt-port-matters" tabindex="-1">4) M1 Pro limitations and why a <strong>downstream Thunderbolt port</strong> matters</h2>
<p>At this moment, it’s roughly clear that a TB3 dock is not going to be sufficient bandwidth wise.</p>
<p>However there’s a bit more nuance here (and why we actually need a higher-end dock with a <strong>downstream</strong> TB4 port):</p>
<ul>
<li><strong>M1 Pro MacBook Pro (2021)</strong> supports <strong>up to two external displays</strong> over Thunderbolt (each up to 6K60). That’s a <em>hard</em> GPU/display-engine limit on count, not just raw bandwidth.</li>
<li>MacOS does not support DisplayPort MST for extended desktops. In plain English: you can’t split one DP lane group into two independent desktops via an MST hub and expect macOS to see two displays—it will mirror them.<br>
<strong>Implication:</strong> to run <strong>two</strong> external monitors over <strong>one cable</strong>, we need a <strong>Thunderbolt dock</strong> that exposes <strong>two independent DP tunnels</strong> (e.g., one physical DP output <strong>plus</strong> a <strong>downstream TB</strong> port for the second display via USB-C→DP).</li>
</ul>
<p>The <strong>TB3DOCK2DPPD</strong> does exactly that: one native DP port <strong>and</strong> one <strong>downstream TB3</strong> port intended to carry the second display. The constraint, again, is that both of those hops are <strong>DP 1.2</strong> only.</p>
<p>A lot of the lower-end docks, on the other hand, <strong>do NOT carry downstream TB ports</strong> and hence not suited for such setup.</p>
<p><strong>Putting it together:</strong></p>
<ul>
<li>To keep the single-cable topology, we should use the dock’s <strong>DP</strong> for one monitor and the <strong>downstream TB3→USB-C/DP</strong> for the other.</li>
<li>We also need a <strong>DP 1.4-capable TB3/TB4 dock</strong> (Titan Ridge, Goshen Ridge/TB4) to fulfill the bandwidth requirements for the 2 monitors at high refresh rate.</li>
</ul>
<hr>
<h2 id="5)-summary" tabindex="-1">5) Summary</h2>
<ul>
<li><strong>Yes, the single-cable topology can work</strong>—with caveats. On the <strong>Alpine Ridge TB3 dock (DP 1.2)</strong>, run the <strong>AW3821DW at 100 Hz</strong> and the new <strong>2560×1440 at 100 Hz</strong>, both at <strong>8-bpc RGB 4:4:4</strong>.</li>
<li>The dock will not do <strong>3840×1600 @ 144 Hz</strong> concurrently with a high-refresh second display; DP 1.2 per-link bandwidth is the blocker.</li>
<li>Because <strong>macOS lacks MST-Extended</strong>, we also need to ensure the dock provides a <strong>downstream Thunderbolt port</strong>.</li>
</ul>
<hr>
<h2 id="references" tabindex="-1">References</h2>
<p>[1] Apple — <em>MacBook Pro (14-inch, 2021) Tech Specs</em> (external display support) – <a href="https://support.apple.com/en-us/111902">https://support.apple.com/en-us/111902</a><br>
[2] Dell — <em>Alienware AW3821DW product page</em> (3840×1600 @ 144 Hz over DP) – <a href="https://www.dell.com/en-us/shop/alienware-38-curved-gaming-monitor-aw3821dw/apd/210-axvg/monitors-monitor-accessories">https://www.dell.com/en-us/shop/alienware-38-curved-gaming-monitor-aw3821dw/apd/210-axvg/monitors-monitor-accessories</a><br>
[3] RTINGS — <em>Chroma Subsampling: 4:4:4 vs 4:2:2 vs 4:2:0</em> – <a href="https://www.rtings.com/tv/learn/chroma-subsampling">https://www.rtings.com/tv/learn/chroma-subsampling</a><br>
[4] Eaton/Tripp Lite — <em>DisplayPort explained</em> (8b/10b vs 128b/132b; effective payloads) – <a href="https://www.eaton.com/us/en-us/products/backup-power-ups-surge-it-power-distribution/backup-power-ups-it-power-distribution-resources/cpdi-vertical-marketing/displayport-explained.html">https://www.eaton.com/us/en-us/products/backup-power-ups-surge-it-power-distribution/backup-power-ups-it-power-distribution-resources/cpdi-vertical-marketing/displayport-explained.html</a><br>
[5] Cable Matters — <em>DisplayPort 1.4 vs 1.2: What’s the Difference?</em> (21.6 vs 32.4 Gbps raw; 17.28 vs 25.92 Gbps payload) – <a href="https://www.cablematters.com/Blog/DisplayPort/displayport-1-4-vs-1-2">https://www.cablematters.com/Blog/DisplayPort/displayport-1-4-vs-1-2</a><br>
[6] Wikipedia — <em>DisplayPort</em> (TB3 Alpine Ridge DP 1.2 vs Titan Ridge DP 1.4) – <a href="https://en.wikipedia.org/wiki/DisplayPort">https://en.wikipedia.org/wiki/DisplayPort</a><br>
[7] StarTech — <em>TB3DOCK2DPPD Manual</em> (identifies <strong>JHL6540 Alpine Ridge</strong> chipset, DP 1.2 heritage) – <a href="https://sgcdn.startech.com/005329/media/sets/tb3dock2dppd_manual/tb3dock2dppd_tb3dock2dppu_thunderbolt_3_dock.pdf">https://sgcdn.startech.com/005329/media/sets/tb3dock2dppd_manual/tb3dock2dppd_tb3dock2dppu_thunderbolt_3_dock.pdf</a><br>
[8] StarTech — <em>TB3DOCK2DPPD Datasheet</em> (dual-4K60 via DP + downstream TB3) – <a href="https://media.startech.com/cms/pdfs/tb3dock2dppd_datasheet.pdf">https://media.startech.com/cms/pdfs/tb3dock2dppd_datasheet.pdf</a><br>
[9] Plugable KB — <em>MST on macOS (Extended not supported)</em> – <a href="https://kb.plugable.com/understanding-mst-multi-display-setups-with-windows-macos-and-displayport">https://kb.plugable.com/understanding-mst-multi-display-setups-with-windows-macos-and-displayport</a><br>
[10] Intel — <em>Thunderbolt 3 vs Thunderbolt 4</em> (TB4 mandates dual 4K or one 8K) – <a href="https://www.intel.com/content/www/us/en/architecture-and-technology/thunderbolt/thunderbolt-3-vs-4.html">https://www.intel.com/content/www/us/en/architecture-and-technology/thunderbolt/thunderbolt-3-vs-4.html</a><br>
[11] Wikipedia — <em>USB4</em> (DP 1.4a tunneling in USB4 v1; DP 2.1 in USB4 v2) – <a href="https://en.wikipedia.org/wiki/USB4">https://en.wikipedia.org/wiki/USB4</a></p>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2025/09/01/Journey-to-enable-M1-pro-single-thunderbolt/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-right">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2020/11/28/PXE-Boot-Diskless-Raspberry-Pi-4-With-Ubuntu-Ubiquiti-and-Synology-2-Config-TFTP-and-NFS-mounts/"
                            aria-label=": PXE Boot Diskless Raspberry Pi 4 With Ubuntu, Ubiquiti and Synology (2): Config TFTP and NFS mounts"
                        >
                            PXE Boot Diskless Raspberry Pi 4 With Ubuntu, Ubiquiti and Synology (2): Config TFTP and NFS mounts
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-28T21:37:17-08:00">
	
		    Nov 28, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-excerpt">
                    <p>Once we get the DHCP part set up, here comes the exciting part - to actually install the Linux distro and boot the Pi using it instead of the vanilla 32-bit Raspberry Pi OS.</p>
<p>Now our Pi is still stuck at the initial screen, but don’t worry, as long as it is trying to read the tftp path we have made progress.</p>
<h2 id="Enable-TFTP-on-the-Server-Side"><a href="#Enable-TFTP-on-the-Server-Side" class="headerlink" title="Enable TFTP on the Server Side"></a>Enable TFTP on the Server Side</h2><p>Here I will be using the Synology NAS server as the file system server.</p>
<p>Synology offers tftp support in file sharing directly. On the other hand, it’s also fairly straightforward to set up a TFTP server using a Linux server. One thing important is to remember the tftp root directory. That will be used in the next step to copy over the boot files to.</p>
<p>Under that directory create the Pi corresponding directory like</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;tftp root&gt;/123456789</span><br></pre></td></tr></table></figure>

<p><code>123456789</code> refers to last 9 chars of serial no. Pi’s bootloader by default will load from there.</p>
<h2 id="Create-the-TFTP-boot-directory"><a href="#Create-the-TFTP-boot-directory" class="headerlink" title="Create the TFTP boot directory"></a>Create the TFTP boot directory</h2><p>We need to first grab the Linux distro from an image.</p>
<p>Here I picked Ubuntu 20.04 LTS which is “officially” supported. Technically this is probably not the best option as the OS itself includes a lot of things that we may not actually need and the size is pretty bulky. On the other end the Alpine one is very skinny and lacks some of the tooling we may need initially. For raspberry, unfortunately each distro may be slightly different (in terms of boot) so while you are free to choose whatever you want, YMMV.</p>
<p>Flash the image into the SD card and we’ll get 2 partitions - boot and root.</p>
<p>In general, it’s a good idea to first boot the system using the SD card just in case there’s some essential setup we need to complete ahead of time. After that, the remaining Pi boards can replicate the same set of files with minor tweaks.</p>
                    
                        <a
                            href="/2020/11/28/PXE-Boot-Diskless-Raspberry-Pi-4-With-Ubuntu-Ubiquiti-and-Synology-2-Config-TFTP-and-NFS-mounts/"
                            class="postShorten-excerpt_link link"
                            aria-label=": PXE Boot Diskless Raspberry Pi 4 With Ubuntu, Ubiquiti and Synology (2): Config TFTP and NFS mounts"
                        >
                            Continue reading
                        </a>
                        
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-right">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2020/11/28/PXE-Boot-Diskless-Raspberry-Pi-4-With-Ubuntu-Ubiquiti-and-Synology-1-DHCP-Setup/"
                            aria-label=": PXE Boot Diskless Raspberry Pi 4 With Ubuntu, Ubiquiti and Synology (1): DHCP Setup"
                        >
                            PXE Boot Diskless Raspberry Pi 4 With Ubuntu, Ubiquiti and Synology (1): DHCP Setup
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-28T12:00:16-08:00">
	
		    Nov 28, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-excerpt">
                    <p>Raspberry Pi 4 is shipped with a flashable EEPROM and supports netbooting. However, the entire setup process is not that straightforward and it’s thus worth writing down all the pitfalls through the path especially when it involves a non-“native” Linux distribution.</p>
<p>One thing worth noting is that even though this post mentions “PXE” and so does the official document, the boot process isn’t entirely PXE compliant and thus regular PXE boot support setup process may not work at all or at least not directly.</p>
<p>Here’s a diagram of the network topology I use for the setup:</p>
<img src="/2020/11/28/PXE-Boot-Diskless-Raspberry-Pi-4-With-Ubuntu-Ubiquiti-and-Synology-1-DHCP-Setup/net-topo.png" />

<p>The Ubiquiti will also be serving as the DHCP server. The Synology NAS will be serving data via tftp (pxe boot) and nfs (post boot). Due to kernel limitation, my NAS cannot support overlayfs. But for newer version of NAS it might be possible.</p>
<h2 id="Raspberry-Netboot-Sequence"><a href="#Raspberry-Netboot-Sequence" class="headerlink" title="Raspberry Netboot Sequence"></a>Raspberry Netboot Sequence</h2><p>The bootloader in EEPROM by default does not enable netboot so we’d need to enable that first.</p>
<p>Once enabled, upon powering up, Pi will first send a DHCP request to ask for the TFTP server location and verify if netboot is supported.</p>
<p>After that it will fetch the firmware (start4.elf), configs and kernel files (vmlinuz) from that tftp location. The bootloader has a config to specify the exact path for the current device. By default, that’s the last 9 chars of the serial number. This is important as certain config (like cmdline.txt) would tell the OS how to mount the root fs and thus needs to be separate.</p>
<p>The kernel will later be loaded which takes over the boot process and eventually loads the rest of the system distribution.</p>
<p>The official doc can be found <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bootmodes/net.md">here</a>.</p>
<h2 id="Flashing-the-EEPROM-to-Enable-Netboot"><a href="#Flashing-the-EEPROM-to-Enable-Netboot" class="headerlink" title="Flashing the EEPROM to Enable Netboot"></a>Flashing the EEPROM to Enable Netboot</h2><p>With the basic knowledge equipped, we can continue by first enabling the netboot in bootloader.</p>
<p>To do that, we need to grab the updated version of bootcode.bin file which supports netboot and update the config.</p>
<p>This also requires using the raspberry cli binary vcgencmd.</p>
<p><strong>Pitfall #1: vcgencmd can only work in native Raspberry Pi OS</strong></p>
<p>Yes the vcgencmd binary does not work in Ubuntu or any other “supported” Linux distros, even if you compile from source. They would just silently fail. Technically it should be doable if they are shipped with the right “stuff” but I decide not to waste more time figuring out what the “stuff” is.</p>
<p>Here we need a small microSD card to flash the Raspberry Pi OS onto it and boot the system. For headless setup, don’t forget to <code>touch ssh</code> to create the file to enable ssh by default.</p>
                    
                        <a
                            href="/2020/11/28/PXE-Boot-Diskless-Raspberry-Pi-4-With-Ubuntu-Ubiquiti-and-Synology-1-DHCP-Setup/"
                            class="postShorten-excerpt_link link"
                            aria-label=": PXE Boot Diskless Raspberry Pi 4 With Ubuntu, Ubiquiti and Synology (1): DHCP Setup"
                        >
                            Continue reading
                        </a>
                        
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-right">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2020/05/23/Why-Keeping-High-Standard-of-Shit-Is-Important/"
                            aria-label=": Why Keeping High Standards of Shit Is Important"
                        >
                            Why Keeping High Standards of Shit Is Important
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-23T16:54:54-07:00">
	
		    May 23, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-excerpt">
                    <p>We all write shitty code.</p>
<p>This seems like a stupidly bold statement from a random person, especially when this person very likely writes shitter stuff than most others. After all, there’s a well known joke across the industry - that is, Jeff Dean does not write buggy code, and when he does, it’s the problem of the compiler. So at least we have one counter example.</p>
<p>In common sense, masters don’t write shit, and Linus Torvalds very likely nods in the line.</p>
<p>Well, technically speaking, before we criticize this non sense bold statement, we need to define what shit is. And here, I think shitty code is <strong>anything that does not live up to the expectation</strong>. Buggy code is shitty - because it doesn’t provide consistently correct results when people expect it to. However, in the real world, we tend to operate at a much higher level - we care more about contracts, functionalities, and behaviors, and less about the exact implementations. For example, when we use an API service, we tend to care about what features it can provide, the QPS it can support, and how easily we can use it - in essence, our expectation. We probably won’t care about whether it’s run on bare metal or some public cloud, whether the memory is manually managed, by compiler, or by garbage collection.</p>
<p>Does that then mean all services/software that fail to match expectation start with shitty code? Well not necessarily. Windows 9x was great at the time it was first introduced and enabled a whole industry. Yet as things evolved, a lot of the design issues started to get exacerbated and it eventually got completely replaced by NT kernel. I’m not trying to defend 9x and saying it was very well designed masterpiece by any means - it had some notorious kernel safety issues after all, but just using it as an example to show that even if some software had highlights, over time other factors could expose the shittiness inside - it’s just a matter of time. What I believe is that no matter how well the systems were designed and implemented at the beginning, they deteriorate over time. We cannot prevent things from turning into shit - we can only slow down the speed.</p>
<p>What makes things more complicated is that, often times, there are way too many factors that have impact on how we value software:</p>
                    
                        <a
                            href="/2020/05/23/Why-Keeping-High-Standard-of-Shit-Is-Important/"
                            class="postShorten-excerpt_link link"
                            aria-label=": Why Keeping High Standards of Shit Is Important"
                        >
                            Continue reading
                        </a>
                        
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-right">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                            aria-label=": Make Wireless BackHaul Great Again: Disable Orbi 2.4G Backhaul"
                        >
                            Make Wireless BackHaul Great Again: Disable Orbi 2.4G Backhaul
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-04-04T21:14:57-07:00">
	
		    Apr 04, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-excerpt">
                    <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR;"></a>TL;DR;</h2><p>I was able to “break” Orbi’s 2.4G backhaul fallback<br>and hence force it onto 5G.</p>
<p>So instead of this</p>
<img src="/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/slowspeed.png" style="width: 400px" />

<p>I got this:</p>
<img src="/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/speed.png" style="width: 400px" />

<p>The solution isn’t clean. Basically telnet to the satellite and then</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@RBS20:/# config set wlg_sta_ssid=&lt;original ssid&gt;_disabled</span><br><span class="line">root@RBS20:/# config commit </span><br></pre></td></tr></table></figure>

<p>Then reboot.</p>
<p>More details and investigation<br><br>↓</p>
                    
                        <a
                            href="/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                            class="postShorten-excerpt_link link"
                            aria-label=": Make Wireless BackHaul Great Again: Disable Orbi 2.4G Backhaul"
                        >
                            Continue reading
                        </a>
                        
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-right">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/"
                            aria-label=": Monitor gRPC Microservices in Kubernetes with Amazon X-Ray"
                        >
                            Monitor gRPC Microservices in Kubernetes with Amazon X-Ray
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2018-11-25T14:11:39-08:00">
	
		    Nov 25, 2018
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Operation/">Operation</a>, <a class="category-link" href="/categories/Operation/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-excerpt">
                    <p>Microservice architecture is typically useful to solve certain scaling problems where service decoupling/segregation is required to improve development velocity, make service more fault tolerant or handle performance hotspots.</p>
<p>However, everything comes with a price and so does microservice. One typical issue is:</p>
<img src="/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/ms-failure.png" style="width: 600px" />

<p>While this is half joking, monitoring and fault resilency are definitely more challenging in microservice world. While there are frameworks like Hystrix and resilience4j to handle circuit breaking, rate limiting and stuff like that, this post focuses on the first thing: how the heck are my services talking to each other?</p>
<p>AWS X-Ray can fill the gap here by offering service mapping and tracing and thus you can see something like</p>
<img src="/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/xray.png" class="">

<img src="/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/tracing.png" class="">

<p>Compared to generic service monitoring,<br>X-Ray has some additional benefits around AWS ecosystem in that<br>it will auto expose your AWS resource write<br>(yes only write unfortunately) call insights when you use AWS SDK.<br>This applies to SQS, SNS and DynamoDB.</p>
                    
                        <a
                            href="/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/"
                            class="postShorten-excerpt_link link"
                            aria-label=": Monitor gRPC Microservices in Kubernetes with Amazon X-Ray"
                        >
                            Continue reading
                        </a>
                        
                    
                </div>
            
        </div>
        
            <a
                href="/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/"
                aria-label=": Monitor gRPC Microservices in Kubernetes with Amazon X-Ray"
            >
                <div class="postShorten-thumbnailimg">
                    <img alt="" src="https://xunnanxu.github.io/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/xray.png"/>
                </div>
            </a>
            
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-right">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2018/05/14/Angular-4-Custom-Bootstrapping-Lazy-Bind-to-Designated-Container/"
                            aria-label=": Angular 4+ Custom Bootstrapping: Lazy Bind to Designated Container"
                        >
                            Angular 4+ Custom Bootstrapping: Lazy Bind to Designated Container
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2018-05-14T23:50:39-07:00">
	
		    May 14, 2018
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Frontend/">Frontend</a>


    
</div>

            </div>
            
                <div class="postShorten-excerpt">
                    <div class="alert info no-icon"><p>This works for Angular 4-6 so far.</p>
</div>

<br>
If you have ever used Angular 1.x, you know there's a manual bootstrapping
option which looks like:
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">bootstrap</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#myApp&#x27;</span>), [<span class="string">&#x27;myModule&#x27;</span>])<span class="string">`</span></span><br></pre></td></tr></table></figure>
This used to be pretty handy until Angular 2 comes in and changes the life.
For some reason they decide to hide that option and ask people to just use
`bootstrap` in `@NgModule`.

<p>I get that because for general users this is good enough,<br>especially if you are just building a general SPA.<br>However if you want to build something advanced like lazy loading,<br>or conditional rendering, then this seems a bit naive.</p>
<p>This is especially annoying when in React its counterpart is as simple as</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(     </span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">MyApp</span> /&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#myApp&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>This alone won’t drive people away from Angular but it’s just one of the examples<br>that shows Angular wants to force people into its model rather than thinking about<br>use cases in the real world.</p>
<p>Alright enough whining and let’s get to coding. After all, Angular seems excellent<br>especially it covers everything from development, testing, and packaging out of the box.<br>Let’s leave whining till next time.</p>
                    
                        <a
                            href="/2018/05/14/Angular-4-Custom-Bootstrapping-Lazy-Bind-to-Designated-Container/"
                            class="postShorten-excerpt_link link"
                            aria-label=": Angular 4+ Custom Bootstrapping: Lazy Bind to Designated Container"
                        >
                            Continue reading
                        </a>
                        
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-right">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2018/05/13/Building-Linux-Workspace-on-Windows-10-via-WSL/"
                            aria-label=": Building Linux Workspace on Windows 10 via WSL"
                        >
                            Building Linux Workspace on Windows 10 via WSL
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2018-05-13T15:35:46-07:00">
	
		    May 13, 2018
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-excerpt">
                    <img src="/2018/05/13/Building-Linux-Workspace-on-Windows-10-via-WSL/title.png" class="">

<p>I was not really a fan of Windows 10,<br>let alone Microsoft decided to ditch the most important feature I liked in Windows 7 - Aero.<br>In fact, I’d admit that in most cases I use Windows as an entertainment system<br>rather than a working platform.</p>
<p>Don’t get me wrong, Windows is great, both in terms of the quality of the software<br>and the design/usability of the system by itself. It’s also particularly great of you are<br>a .NET developer, a webmaster using IIS, or a game developer heavily using DirectX.<br>However, it’s just cumbersome to use it as a daily OSS platform, namely there lacks the<br>general ecosystem and the tools are just different. Yes you can install node, java, maven,<br>gradle, and you can probably use powershell to write shell scripts, but at the end of the day,<br>the overall configuration just feels different and since most people don’t use Windows<br>for work on a day-to-day basis, it just takes too much time and effort to learn a set of<br>rules with different flavor, just to get the environment set up.</p>
<p>However, things have changed.</p>
<p>The release of WSL (Windows Subsystem on Linux) in Windows 10 was like silent bomb.<br>It wasn’t really marketed to general public, but it implies the fundamental<br>change of attitude from Microsoft towards OSS community.</p>
<p>WSL is not a virtual machine. In fact there’s no real linux kernel running.<br>Instead, there is a layer in between that translates linux system calls to<br>something that windows kernel can handle. Technically, this is seriously phenomenal,<br>as there’s certain things that there’s no direct equivalent in Windows.</p>
<p>For example:</p>
<p>Quoted from <a href="https://blogs.msdn.microsoft.com/wsl/2016/06/08/wsl-system-calls/">MSDN blog</a></p>
<blockquote>
<p>The Linux fork syscall has no documented equivalent for Windows.<br>When a fork syscall is made on WSL, lxss.sys does some of the initial work<br>to prepare for copying the process.<br>It then calls internal NT APIs to create the process with the correct semantics<br>and create a thread in the process with an identical register context.<br>Finally, it does some additional work to complete copying the process<br>and resumes the new process so it can begin executing.</p>
</blockquote>
<p>And another one regarding <a href="https://blogs.msdn.microsoft.com/wsl/2016/06/15/wsl-file-system-support/">WSL file system</a>:</p>
<blockquote>
<p>The Windows Subsystem for Linux must translate various Linux file system operations<br>into NT kernel operations. WSL must provide a place where Linux system files can exist<br>with all the functionality required for that including Linux permissions,<br>symbolic links and other special files such as FIFOs;<br>it must provide access to the Windows volumes on your system;<br>and it must provide special file systems such as ProcFs.</p>
</blockquote>
<p>And now it even supports <a href="https://docs.microsoft.com/en-us/windows/wsl/interop">interop</a><br>after the Fall Creators update. This means if you type in <code>notepad.exe</code>,<br>it would literally open notepad for you. Not very exciting but beyond that you could<br>do</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">copy stuff to clipboard</span></span><br><span class="line">echo &#x27;foo bar&#x27; | clip.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">open a file <span class="keyword">in</span> windows using default associated program</span></span><br><span class="line">cmd.exe /C start image.png</span><br></pre></td></tr></table></figure>

<p><strong>Awesome, but what’s our original topic?</strong></p>
                    
                        <a
                            href="/2018/05/13/Building-Linux-Workspace-on-Windows-10-via-WSL/"
                            class="postShorten-excerpt_link link"
                            aria-label=": Building Linux Workspace on Windows 10 via WSL"
                        >
                            Continue reading
                        </a>
                        
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2018/04/13/Workflow-Processing-Engine-Overview-2018-Airflow-vs-Azkaban-vs-Conductor-vs-Oozie-vs-Amazon-Step-Functions/"
                            aria-label=": Workflow Processing Engine Overview 2018: Airflow vs Azkaban vs Conductor vs Oozie vs Amazon Step Functions"
                        >
                            Workflow Processing Engine Overview 2018: Airflow vs Azkaban vs Conductor vs Oozie vs Amazon Step Functions
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2018-04-13T21:33:33-07:00">
	
		    Apr 13, 2018
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <table>
<thead>
<tr>
<th align="center"></th>
<th>Airflow</th>
<th>Azkaban</th>
<th>Conductor</th>
<th>Oozie</th>
<th>Step Functions</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>Owner</strong></td>
<td>Apache<br>(previously Airbnb)</td>
<td>LinkedIn</td>
<td>Netflix</td>
<td>Apache</td>
<td>Amazon</td>
</tr>
<tr>
<td align="center"><strong>Community</strong></td>
<td>Very Active</td>
<td>Somewhat active</td>
<td>Active</td>
<td>Active</td>
<td>N/A</td>
</tr>
<tr>
<td align="center"><strong>History</strong></td>
<td>4 years</td>
<td>7 years</td>
<td>1.5 years</td>
<td>8 years</td>
<td>1.5 years</td>
</tr>
<tr>
<td align="center"><strong>Main Purpose</strong></td>
<td>General Purpose Batch Processing</td>
<td>Hadoop Job Scheduling</td>
<td>Microservice orchestration</td>
<td>Hadoop Job Scheduling</td>
<td>General Purpose Workflow Processing</td>
</tr>
<tr>
<td align="center"><strong>Flow Definition</strong></td>
<td>Python</td>
<td>Custom DSL</td>
<td>JSON</td>
<td>XML</td>
<td>JSON</td>
</tr>
<tr>
<td align="center"><strong>Support for single node</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td align="center"><strong>Quick demo setup</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>N/A</td>
</tr>
<tr>
<td align="center"><strong>Support for HA</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="center"><strong>Single Point of Failure</strong></td>
<td>Yes<br>(Single scheduler)</td>
<td>Yes<br>(Single web and scheduler combined node)</td>
<td>No</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td align="center"><strong>HA Extra Requirement</strong></td>
<td>Celery/Dask/Mesos + Load Balancer + DB</td>
<td>DB</td>
<td>Load Balancer (web nodes) + DB</td>
<td>Load Balancer (web nodes) + DB + Zookeeper</td>
<td>Native</td>
</tr>
<tr>
<td align="center"><strong>Cron Job</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="center"><strong>Execution Model</strong></td>
<td>Push</td>
<td>Push</td>
<td>Poll</td>
<td>Poll</td>
<td>Unknown</td>
</tr>
<tr>
<td align="center"><strong>Rest API Trigger</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="center"><strong>Parameterized Execution</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="center"><strong>Trigger by External Event</strong></td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="center"><strong>Native Waiting Task Support</strong></td>
<td>Yes</td>
<td>No</td>
<td>Yes (external signal required)</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td align="center"><strong>Backfilling support</strong></td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="center"><strong>Native Web Authentication</strong></td>
<td>LDAP/Password</td>
<td>XML Password</td>
<td>No</td>
<td>Kerberos</td>
<td>N/A (AWS login)</td>
</tr>
<tr>
<td align="center"><strong>Monitoring</strong></td>
<td>Yes</td>
<td>Limited</td>
<td>Limited</td>
<td>Yes</td>
<td>Limited</td>
</tr>
<tr>
<td align="center"><strong>Scalability</strong></td>
<td>Depending on executor setup</td>
<td>Good</td>
<td>Very Good</td>
<td>Very Good</td>
<td>Very Good</td>
</tr>
</tbody></table>
<h2 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h2><ul>
<li><em>(2018.11) Oozie has Kerberos auth over SPNEGO for web (thanks to Justin Miller for pointing it out)</em></li>
</ul>
<h2 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h2><p>I’m not an expert in any of those engines.<br>I’ve used some of those (Airflow &amp; Azkaban) and checked the code.<br>For some others I either only read the code (Conductor) or the docs (Oozie/AWS Step Functions).<br>As most of them are OSS projects, it’s certainly possible that I might have missed certain undocumented features,<br>or community-contributed plugins. I’m happy to update this if you see anything wrong.</p>
<p>Bottom line: Use your own judgement when reading this post.</p>
<h2 id="Airflow"><a href="#Airflow" class="headerlink" title="Airflow"></a>Airflow</h2><h3 id="The-Good"><a href="#The-Good" class="headerlink" title="The Good"></a>The Good</h3><p>Airflow is a super feature rich engine compared to all other solutions.<br>Not only you can use plugins to support all kinds of jobs,<br>ranging from data processing jobs: Hive, Pig (though you can also submit them via shell command),<br>to general flow management like triggering by existence of file/db entry/s3 content,<br>or waiting for expected output from a web endpoint,<br>but also it provides a nice UI that allows you to check your DAGs (workflow dependencies) through code/graph,<br>and monitors the real time execution of jobs.</p>
<p>Airflow is also highly customizable with a currently vigorous community.<br>You can run all your jobs through a single node using local executor,<br>or distribute them onto a group of worker nodes through Celery/Dask/Mesos orchestration.</p>
<h3 id="The-Bad"><a href="#The-Bad" class="headerlink" title="The Bad"></a>The Bad</h3><p>Airflow by itself is still not very mature (in fact maybe Oozie is the only “mature” engine here).<br>The scheduler would need to periodically poll the scheduling plan and send jobs to executors.<br>This means it along would continuously dump enormous amount of logs out of the box.<br>As it works by “ticking”, your jobs are not guaranteed to get scheduled in “real-time” if that makes sense<br>and this would get worse as the number of concurrent jobs increases.<br>Meanwhile as you have one centralized scheduler, if it goes down or gets stuck, your running jobs won’t be<br>affected as that the job of executors, but no new jobs will get scheduled. This is especially confusing when<br>you run this with a HA setup where you have multiple web nodes, a scheduler, a broker<br>(typically a message queue in Celery case), multiple executors. When scheduler is stuck for whatever reason,<br>all you see in web UI is all tasks are running, but in fact they are not actually moving forward while executors<br>are happily reporting they are fine. In other words, the default monitoring is still far from bullet proof.</p>
<p>The web UI is very nice from the first look. However it sometimes is confusing to new users.<br>What does it mean my DAG runs are “running” but my tasks have no state? The charts are not search friendly either,<br>let alone some of the features are still far from well documented<br>(though the document does look nice, I mean, compared to Oozie, which does seem out-dated).</p>
<p>The backfilling design is good in certain cases but very error prone in others.<br>If you have a flow with cron schedules disabled and re-enabled later, it would try to play catch up,<br>and if your jobs is not designed to be idempotent, shit would happen for real.</p>
<h2 id="Azkaban"><a href="#Azkaban" class="headerlink" title="Azkaban"></a>Azkaban</h2><h3 id="The-Good-1"><a href="#The-Good-1" class="headerlink" title="The Good"></a>The Good</h3><p>Of all the engines, Azkaban is probably the easiest to get going out of the box.<br>UI is very intuitive and easy to use. Scheduling and REST APIs works just fine.</p>
<p>Limited HA setup works out of the box.<br>There’s no need for load balancer because you can only have one web node.<br>You can configure how it selects executor nodes to push jobs to and it generally seems to scale pretty nicely.<br>You can easily run tens of thousands of jobs as long as you have enough capacity for the executor nodes.</p>
<h3 id="The-Bad-1"><a href="#The-Bad-1" class="headerlink" title="The Bad"></a>The Bad</h3><p>It is not very feature rich out of the box as a general purpose orchestration engine,<br>but likely that’s not what’s originally designed for. It’s strength lies in native support for Hadoop/Pig/Hive,<br>though you can also achieve those using command line. But itself cannot trigger jobs through external resources like<br>Airflow, nor does it support job waiting pattern. Although you can do busy waiting through java code/scripts, that<br>leads to bad resource utilization.</p>
<p>The documentation and configuration are generally a bit confusing compared to others. It’s likely that it wasn’t supposed<br>to be OSed at the beginning. The design is okish but you better have a big data center to run the executors as scheduling<br>would get stalled when executors run out of resources without extra monitoring stuff. The code quality overall is a bit towards<br>the lower end compared to others so it generally only scales well when resource is not a problem.</p>
<p>The setup/design is not cloud friendly. You are pretty much supposed to have stable bare metal rather than dynamically<br>allocated virtual instances with dynamic IPs. Scheduling would go south if machines vanish.</p>
<p>The monitoring part is sort of acceptable through JMX (does not seem documented). But it generally doesn’t work well if your<br>machines are heavily loaded, unfortunately, as the endpoints may get stuck.</p>
<h2 id="Conductor"><a href="#Conductor" class="headerlink" title="Conductor"></a>Conductor</h2><h3 id="The-Good-2"><a href="#The-Good-2" class="headerlink" title="The Good"></a>The Good</h3><p>It’s a bit unfair to put Conductor into this competition as it’s real purpose is for microservice orchestration, whatever that means.<br>It’s HA model involves a quorum of servers sitting behind load balancer putting tasks onto a message queue which the worker nodes would<br>poll from, which means it’s less likely you’ll run into stalled scheduling.<br>With the help of parameterized execution through API, it’s actually quite good at scheduling and scaling provided<br>that you set up your load balancer/service discovery layer properly.</p>
<h3 id="The-Bad-2"><a href="#The-Bad-2" class="headerlink" title="The Bad"></a>The Bad</h3><p>The UI needs a bit more love. There’s currently very limited monitoring there. Although for general purpose scheduling that’s probably<br>good enough.</p>
<p>It’s pretty bare-bone out of the box. There’s not even native support for running shell scripts, though it’s pretty easy to implement<br>a task worker through python to do the job with the examples provided.</p>
<h2 id="Oozie"><a href="#Oozie" class="headerlink" title="Oozie"></a>Oozie</h2><h3 id="The-Good-3"><a href="#The-Good-3" class="headerlink" title="The Good"></a>The Good</h3><p>Oozie provides a seemingly reliable HA model through the db setup (seemingly b/c I’ve not dug into it).<br>It provides native support for Hadoop related jobs as it was sort of built for that eco system.</p>
<h3 id="The-Bad-3"><a href="#The-Bad-3" class="headerlink" title="The Bad"></a>The Bad</h3><p>Not a very good candidate for general purpose flow scheduling as the XML definition is quite verbose<br>and cumbersome for defining light weight jobs.</p>
<p>It also requires quite a bit of peripheral setup. You need a zookeeper cluster, a db, a load balancer<br>and each node needs to run a web app container like Tomcat. The initial setup also takes some time which is<br>not friendly to first time users to pilot stuff.</p>
<h2 id="Step-Functions"><a href="#Step-Functions" class="headerlink" title="Step Functions"></a>Step Functions</h2><h3 id="The-Good-4"><a href="#The-Good-4" class="headerlink" title="The Good"></a>The Good</h3><p>Step Functions is fairly new (launch in Dec 2016). However the future seems promising. With the HA nature of cloud<br>platform and lambda functions, it almost feels like it can easily scale infinitely (compared to others).</p>
<p>It also offers some useful features for general purpose workflow handling like waiting support and dynamic branching<br>based on output.</p>
<p>It’s also fairly cheap:</p>
<ul>
<li>4,000 state transitions are free each month</li>
<li>$0.025 per 1,000 state transitions thereafter ($0.000025 per state transition)</li>
</ul>
<p>If you don’t run tens of thousands of jobs, this might be even better than running your own cluster of things.</p>
<h3 id="The-Bad-4"><a href="#The-Bad-4" class="headerlink" title="The Bad"></a>The Bad</h3><p>Can only be used by AWS users. Deal breaker if you are not one of them yet.</p>
<p>Lambda requires extra work for production level iteration/deployment.</p>
<p>There’s no UI (well there is but it’s really just a console).<br>So if you need any level of monitoring beyond that you need to build it using cloudwatch by yourself.</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2018/04/13/Workflow-Processing-Engine-Overview-2018-Airflow-vs-Azkaban-vs-Conductor-vs-Oozie-vs-Amazon-Step-Functions/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2016/10/03/You-Don-t-Know-JS-Equal-or-Not-Equal/"
                            aria-label=": You Don&#39;t Know JS - Equal or Not Equal"
                        >
                            You Don&#39;t Know JS - Equal or Not Equal
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2016-10-03T19:40:48-07:00">
	
		    Oct 03, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/You-Don-t-Know-JS/">You Don't Know JS</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#and"><span class="toc-text">&#x3D;&#x3D; and &#x3D;&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dig-deeper"><span class="toc-text">Dig deeper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What-about-arrays"><span class="toc-text">What about arrays?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What-about-objects"><span class="toc-text">What about objects</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implicit-conversions"><span class="toc-text">Implicit conversions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a></li></ol>

<h2 id="and"><a href="#and" class="headerlink" title="== and ==="></a>== and ===</h2><p>Likely you know the difference between <code>==</code> and <code>===</code>: basically, <code>===</code> means strict equality where no implicit conversion is allowed whereas <code>==</code> is loose equality.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&#x27;a&#x27;</span> === <span class="string">&#x27;a&#x27;</span>     <span class="comment">// true</span></span><br><span class="line"><span class="number">0</span> == <span class="literal">false</span>      <span class="comment">// true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Dig-deeper"><a href="#Dig-deeper" class="headerlink" title="Dig deeper"></a>Dig deeper</h2><p>OK but this is too boring since we all know that.</p>
<p>How about this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">String</span>(<span class="string">&#x27;a&#x27;</span>) === <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;a&#x27;</span>) === <span class="string">&#x27;a&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Well the answers are <code>true</code> and <code>false</code> because <code>String()</code> returns a primitive string while <code>new String()</code> returns a string object. Surely <code>new String(&#39;a&#39;) == &#39;a&#39;</code> yields <code>true</code>. No surprise.</p>
<h3 id="What-about-arrays"><a href="#What-about-arrays" class="headerlink" title="What about arrays?"></a>What about arrays?</h3><pre><code>[] === []</code></pre><p>Well this returns <code>false</code> because for non-primitive objects, they are compared by reference. This always returns <code>false</code> because they are different in terms of memory location.</p>
<p>However surprisingly you can compare arrays like this:</p>
<pre><code>[1, 2, 3] &lt; [2, 3]      // true
[2, 1, 3] &gt; [1, 2, 3]   // true</code></pre><img src="http://www.memes.at/faces/blonde_hmmm.jpg" alt="Blonde hmmm" style="width:125px">

<p>(Wait a sec. I think I have an idea.)</p>
<p>How about this:</p>
<pre><code>function arrEquals(arr1, arr2) &#123;
    return !(arr1 &lt; arr2) &amp;&amp; !(arr2 &lt; arr1);
&#125;</code></pre><img src="http://www.memes.at/faces/fuck_yeah_smile.jpg" alt="Fuck yeah smile" style="width:125px">

<p>Well this is wrong because arrays will be flattened when compared, like this</p>
<pre><code>[[1, 2], 1] &lt; [1, 2, 3]     // true</code></pre><h3 id="What-about-objects"><a href="#What-about-objects" class="headerlink" title="What about objects"></a>What about objects</h3><p>What’s the result of this expression?</p>
<pre><code>&#123;&#125; === &#123;&#125;</code></pre><p>Well it’s neither <code>true</code> nor <code>false</code> but you get <code>SyntaxError</code> because in this case <code>&#123;&#125;</code> is not an object literal but a code block and thus it cannot be followed with <code>=</code>. Anyway we are drifting away from the original topic…</p>
<h2 id="Implicit-conversions"><a href="#Implicit-conversions" class="headerlink" title="Implicit conversions"></a>Implicit conversions</h2><p>Well that’s just warm-up. Let’s see something serious.</p>
<p>If you read something about “best practices”, you would probably be told not to use <code>==</code> because of the evil conversion. However chances are you’ve used it here and there and most likely that’s also part of the “best practices”.</p>
<p>For example:</p>
<pre><code>var foo = bar();
if (foo) &#123;
    doSomething();
&#125;</code></pre><p>This works because in JavaScript, only 6 object/literals are evaluated to <code>false</code>. They are <code>0</code>, <code>&#39;&#39;</code>, <code>NaN</code>, <code>undefined</code>, <code>null</code> and of course <code>false</code>. Rest of the world evaluates to <code>true</code>, including <code>&#123;&#125;</code> and <code>[]</code>.</p>
<p>Hmm here’s something wacky:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="attr">valueOf</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!(<span class="number">1</span> + a)) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;boom&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Your code does go boom because <code>1 + a</code> gets implicitly converted to <code>1 + a.valueOf()</code> and hence yields <code>0</code>.</p>
<p>The actual behavior is documented in ECMA standard - <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-abstract-equality-comparison">http://www.ecma-international.org/ecma-262/6.0/#sec-abstract-equality-comparison</a></p>
<p>In most cases, implicit conversion would cause <code>valueOf()</code> to be called or falls back to <code>toString()</code> if not defined.</p>
<p>For example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">    <span class="attr">valueOf</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;value&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">toString</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;toString&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;foo&#x27;</span> + foo             <span class="comment">// foovalue</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>This is because according to standard, when <code>toPrimitive</code> is invoked for implicit conversion with no <em>hint</em> provided (e.g. in the case of concatenation, or when <code>==</code> is used between different types), it by default prefers <code>valueOf</code>. There are a few exceptions though, including but not limited to <code>Array.prototype.join</code> and <code>alert</code>. They would call <code>toPrimitive</code> with <code>string</code> as the hint so <code>toString()</code> will be favored.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In general, you probably want to avoid using <code>==</code> and use <code>===</code> most of the time if not always to avoid worrying about wonky implicit conversion magic.</p>
<p>However, you can’t be wary enough. For example:</p>
<pre><code>isNaN(&apos;1&apos;) === true</code></pre><p>You might think that <code>&#39;1&#39;</code> is a string and hence this should be <code>false</code> but unfortunately <code>isNaN</code> always calls <code>toNumber</code> internally (<a href="http://www.ecma-international.org/ecma-262/6.0/#sec-tonumber">spec</a>) and hence this is <code>true</code>.</p>
<img src="http://www.memes.at/faces/computer_stare.jpg" alt="Computer stare" style="width:200px">

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2016/10/03/You-Don-t-Know-JS-Equal-or-Not-Equal/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/archives/page/2/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 1 of 2</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Shawn Xu. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Shawn Xu</h4>
        
            <div id="about-card-bio"><p>Software Engineer in Bay Area</p>
</div>
        
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-a5wszscostah6olx2wgfq7mglfmluysmmlvnxgmmszk3gwouxhlbwbsk0xkf.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
