
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Shawn&#39;s Pitstop">
    <title>Make Wireless BackHaul Great Again: Disable Orbi 2.4G Backhaul - Shawn&#39;s Pitstop</title>
    <meta name="author" content="Shawn Xu">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Shawn Xu","sameAs":["https://github.com/xunnanxu"],"image":"https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg"},"articleBody":"TL;DR;I was able to “break” Orbi’s 2.4G backhaul fallbackand hence force it onto 5G.\nSo instead of this\n\n\nI got this:\n\n\nThe solution isn’t clean. Basically telnet to the satellite and then\n12root@RBS20:/# config set wlg_sta_ssid=&lt;original ssid&gt;_disabledroot@RBS20:/# config commit\n\nThen reboot.\nMore details and investigation↓\n\n\nBackgroundA while back, I got the Netgear Orbi RBK20to replace my original not so reliable powerline setup.\n\n\nIt’s a wifi mesh solution that aims to solve the problemwhere traditional single pointer router fails -to provide good signal coveragein complex indoor environment with walls in between rooms.This is esp. important in the AC world wherethe 5G signal falls short as it tends to be more easily blocked/than 2.4G.\nOne thing worth mentioning though is that Orbi isn’ta true mesh system, that is, to support 802.11s mesh standard.A true mesh system allows satellites to cooperate togetherthrough a routing algorithm to find the optimal data transfer pathbut Orbi basically supports only star topology or daisy chaining.That said though, in practice, some of the “advanced” true mesh systemson the other hand suffer from lack of dedicated backhaul channelfor inter satellite uplink (e.g. Google Wifi) and hence actuallyperform much worse in reality as they essentially just becomemore advanced repeaters.\nProblemIn order for Orbi to have max power, we need toensure that Orbi has the dedicated backhaul operate in 5G mode,otherwise anything connected to satellites would be bound to2.4G speed which is 192Mbps.\nIt’s not unusable technically but it sort of defeats the purpose.What makes things worse is that Netgear decides on a strategythat if 5G backhaul isn’t stable, it would fall back onto 2.4G,which isn’t dedicated but shared with regular 2.4G radio.This isn’t a bad idea per se as home layout may be complex sothey sacrifice throughtput in favor of usability in certainscenarios.\nHowever this setup doesn’t work well in practice.For whatever reason, the system would fall back onto 2.4Grandomly even if 5G signal is perfectly fine. And the onlyway to fix that would be to power cycle the satellite.\nInvestigationSince Orbi is OpenWRT based, I took a look at the configsthat potentially control the behavior and here they are:\n12345678910111213141516171819202122root@RBS20:/# uci show | grep WiFiLink...repacd.WiFiLink.RSSIThresholdFar='-75'repacd.WiFiLink.RSSIThresholdFar5g='-82'repacd.WiFiLink.RSSIThresholdFar24g='-76'repacd.WiFiLink.RSSIThresholdNear='-60'repacd.WiFiLink.RSSIThresholdMin='-75'repacd.WiFiLink.RSSIThresholdPrefer2GBackhaul='-82'repacd.WiFiLink.2GBackhaulSwitchDownTime='10'repacd.WiFiLink.MaxMeasuringStateAttempts='30'repacd.WiFiLink.DaisyChain='1'repacd.WiFiLink.RateNumMeasurements='5'repacd.WiFiLink.RateThresholdMin5GInPercent='35'repacd.WiFiLink.RateThresholdMax5GInPercent='95'repacd.WiFiLink.RateThresholdPrefer2GBackhaulInPercent='5'repacd.WiFiLink.5GBackhaulBadlinkTimeout='60'repacd.WiFiLink.BSSIDAssociationTimeout='170'repacd.WiFiLink.RateScalingFactor='85'repacd.WiFiLink.5GBackhaulEvalTimeShort='330'repacd.WiFiLink.5GBackhaulEvalTimeLong='1800'repacd.WiFiLink.2GBackhaulEvalTime='1800'...\n\nSo in theory 2G backhaul should only be preferredafter signal drops below -82dbm or rate is below 5%/35%.However in practice this almost is never the case.\n123456# From router side:root@RBR20:/# wlanconfig ath11 listADDR               AID CHAN TXRATE RXRATE RSSI MINRSSI MAXRSSI IDLE  TXSEQ  RXSEQ  CAPS        ACAPS ERP    STATE MAXRATE(DOT11) HTCAPS ASSOCTIME    IEs   MODE                   PSMODE                     1  157 866M    780M   51      44      58    0      0   65535   EPs         0   b              0           AWPSM 18:46:39     RSN WME IEEE80211_MODE_11AC_VHT80   0\n\nRSSI here is 51 which indicates roughly -44dbmwhich is perfectly fine. It’s possible that the number wouldfluctuate during operation but as you see the min valueis still way above the threshold. Also in practice,once Orbi picks 2.4G it will stick there which doesn’t make sensebut since Orbi’s software isn’t open sourced there’s no way to knowexactly how it messes things up (looking at you Netgear developers).\nA Hacky SolutionEnable TelnetGo to http://&lt;satellite ip&gt;/debug.htm, log in with router username &amp; passwordand check “Enable Telnet”.\n\n\nInitial AttemptSince we cannot alter Netgear’s software behavior directly,we have to somehow break the 2.4G connection to force it onto 5G.\nMy initial thought was to disable the 2.4G wifi interface.(Spoiler: this does not work somehow).\nThis is doable via OpenWRT’s config system.\n12345678910111213141516171819202122232425262728293031# Show all wifi interfaces. The 2.4G is already disabled here but in normal operation it will show something.root@RBS20:/# iwconfigath01     IEEE 802.11b  ESSID:\"NETGEAR_ORBI_hidden52\"          Mode:Managed  Frequency:2.412 GHz  Access Point: Not-Associated          Bit Rate:0 kb/s   Tx-Power:25 dBm          RTS thr:off   Fragment thr:off          Power Management:off          Link Quality=0/94  Signal level=-95 dBm  Noise level=-95 dBm          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0          Tx excessive retries:0  Invalid misc:0   Missed beacon:0root@RBS20:/# vi /etc/config/wirelessconfig wifi-iface        option device 'wifi0'        option network '0'        option bridge 'br0'        option mode 'sta'        option wds '1'        option athnewind '1'        option vap_ind '0'        option backhaul '1'        option wsplcd_unmanaged '1'        option repacd_security_unmanaged '1'        option dropmdns '0'        option ssid 'NETGEAR_ORBI_hidden52'        option encryption 'psk2+ccmp'        option ifname 'ath01'        option wps_config 'virtual_push_button physical_push_button'        option wps_pbc '1'        option dyn_bw_rts '0'        option disabled '0'\n\n^ From there we can see ath01 is bound to physical interface wifi0.We can just change the disabled value from 0 to 1.Then uci commit will persist the value.\nHowever for some reason, Orbi will restore values in OpenWRT config,presumably for system integrity reason. YMMV but at least this doesnot work for RBK20 system.\nThe Hacky AttemptWhile Orbi restores uci configs, it does keep its own configsthat are alterable via config.\nThen essentially the solution becomes that we can change the 2.4Gbackhaul SSID such that it cannot find the right one.\nIn my system the original SSID is NETGEAR_ORBI_hidden52 fromiwconfig.We can grab all related configs from\n12345root@RBS20:/# config show | grep hidden52wlg_ap_bh_ssid=NETGEAR_ORBI_hidden52wla_ap_bh_ssid=NETGEAR_ORBI_hidden52wla_sta_ssid=NETGEAR_ORBI_hidden52wlg_sta_ssid=NETGEAR_ORBI_hidden52\n\nHere anything starts with wla is 5G and wlg is 2.4G.\nThen we can do\n12root@RBS20:/# config set wlg_sta_ssid=NETGEAR_ORBI_hidden52_disabledroot@RBS20:/# config commit\n\nThe _disabled suffix is arbitrary with the idea to preventOrbi from connecting to router via 2.4G.\nwlg_ap_bh_ssid does not need to be set. The ap setup willautomatically follow the sta setup.\nnvram show | grep ssid should now show the persisted value.\nIn RBS20, if you use reboot to restart the system,it will somehow get stuck with pink led light.So I always just power cycle it, which works just fine.\nTo confirm this works, on satellite side, once restarted,iwconfig should show the new SSID and signal strength should be-95dbm indicating it’s disconnected.\nEnable Telnet in router and log into it. \n12345678# ath01 is 2.4G wifi interface. It should have nothing connected now.root@RBR20:/# wlanconfig ath01 list# ath11 is 5G. It should have satellite(s) connected.root@RBR20:/# wlanconfig ath11 listADDR               AID CHAN TXRATE RXRATE RSSI MINRSSI MAXRSSI IDLE  TXSEQ  RXSEQ  CAPS        ACAPS ERP    STATE MAXRATE(DOT11) HTCAPS ASSOCTIME    IEs   MODE                   PSMODE                     1  157 866M    780M   51      44      58    0      0   65535   EPs         0   b              0           AWPSM 19:26:27     RSN WME IEEE80211_MODE_11AC_VHT80   0\n\n","dateCreated":"2020-04-04T21:14:57-07:00","dateModified":"2020-04-05T13:13:50-07:00","datePublished":"2020-04-04T21:14:57-07:00","description":"TL;DR;I was able to “break” Orbi’s 2.4G backhaul fallbackand hence force it onto 5G.\nSo instead of this\n\n\nI got this:\n\n\nThe solution isn’t clean. Basically telnet to the satellite and then\n12root@RBS20:/# config set wlg_sta_ssid=&lt;original ssid&gt;_disabledroot@RBS20:/# config commit\n\nThen reboot.\nMore details and investigation↓","headline":"Make Wireless BackHaul Great Again: Disable Orbi 2.4G Backhaul","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"},"publisher":{"@type":"Organization","name":"Shawn Xu","sameAs":["https://github.com/xunnanxu"],"image":"https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg","logo":{"@type":"ImageObject","url":"https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg"}},"url":"https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/","keywords":"wifi, openwrt"}</script>
    <meta name="description" content="TL;DR;I was able to “break” Orbi’s 2.4G backhaul fallbackand hence force it onto 5G. So instead of this   I got this:   The solution isn’t clean. Basically telnet to the satellite and then 12root@RBS2">
<meta name="keywords" content="wifi, openwrt">
<meta property="og:type" content="blog">
<meta property="og:title" content="Make Wireless BackHaul Great Again: Disable Orbi 2.4G Backhaul">
<meta property="og:url" content="https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/index.html">
<meta property="og:site_name" content="Shawn&#39;s Pitstop">
<meta property="og:description" content="TL;DR;I was able to “break” Orbi’s 2.4G backhaul fallbackand hence force it onto 5G. So instead of this   I got this:   The solution isn’t clean. Basically telnet to the satellite and then 12root@RBS2">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/slowspeed.png">
<meta property="og:image" content="https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/speed.png">
<meta property="og:image" content="https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/RBK20.png">
<meta property="og:image" content="https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/telnet.png">
<meta property="og:updated_time" content="2020-04-05T20:13:50.602Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Make Wireless BackHaul Great Again: Disable Orbi 2.4G Backhaul">
<meta name="twitter:description" content="TL;DR;I was able to “break” Orbi’s 2.4G backhaul fallbackand hence force it onto 5G. So instead of this   I got this:   The solution isn’t clean. Basically telnet to the satellite and then 12root@RBS2">
<meta name="twitter:image" content="https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/slowspeed.png">
    
    
        
    
    
        <meta property="og:image" content="https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-yvywglw62lgxwz25dsjvepo05oagkygdd7st7xfdzhmmxwqoijtiy3ngabtp.min.css">
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83953865-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-83953865-1');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/ "
            aria-label=""
        >
            Shawn&#39;s Pitstop
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Shawn Xu</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Software Engineer in Bay Area</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/xunnanxu"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Make Wireless BackHaul Great Again: Disable Orbi 2.4G Backhaul
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-04-04T21:14:57-07:00">
	
		    Apr 04, 2020
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR;"></a>TL;DR;</h2><p>I was able to “break” Orbi’s 2.4G backhaul fallback<br>and hence force it onto 5G.</p>
<p>So instead of this</p>
<img src="/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/slowspeed.png" style="width: 400px">

<p>I got this:</p>
<img src="/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/speed.png" style="width: 400px">

<p>The solution isn’t clean. Basically telnet to the satellite and then</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@RBS20:/# config set wlg_sta_ssid=&lt;original ssid&gt;_disabled</span><br><span class="line">root@RBS20:/# config commit</span><br></pre></td></tr></table></figure>

<p>Then reboot.</p>
<p>More details and investigation<br><br>↓</p>
<a id="more"></a>

<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>A while back, I got the Netgear Orbi <a href="https://www.netgear.com/support/product/RBK20.aspx" target="_blank" rel="noopener">RBK20</a><br>to replace my original not so reliable powerline setup.</p>
<img src="/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/RBK20.png">

<p>It’s a wifi mesh solution that aims to solve the problem<br>where traditional single pointer router fails -<br>to provide good signal coverage<br>in complex indoor environment with walls in between rooms.<br>This is esp. important in the AC world where<br>the 5G signal falls short as it tends to be more easily blocked/<br>than 2.4G.</p>
<p>One thing worth mentioning though is that Orbi isn’t<br>a true mesh system, that is, to support 802.11s mesh standard.<br>A true mesh system allows satellites to cooperate together<br>through a routing algorithm to find the optimal data transfer path<br>but Orbi basically supports only star topology or daisy chaining.<br>That said though, in practice, some of the “advanced” true mesh systems<br>on the other hand suffer from lack of dedicated backhaul channel<br>for inter satellite uplink (e.g. Google Wifi) and hence actually<br>perform much worse in reality as they essentially just become<br>more advanced repeaters.</p>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>In order for Orbi to have max power, we need to<br>ensure that Orbi has the dedicated backhaul operate in 5G mode,<br>otherwise anything connected to satellites would be bound to<br>2.4G speed which is 192Mbps.</p>
<p>It’s not unusable technically but it sort of defeats the purpose.<br>What makes things worse is that Netgear decides on a strategy<br>that if 5G backhaul isn’t stable, it would fall back onto 2.4G,<br>which isn’t dedicated but shared with regular 2.4G radio.<br>This isn’t a bad idea per se as home layout may be complex so<br>they sacrifice throughtput in favor of usability in certain<br>scenarios.</p>
<p>However this setup doesn’t work well in practice.<br>For whatever reason, the system would fall back onto 2.4G<br>randomly even if 5G signal is perfectly fine. And the only<br>way to fix that would be to power cycle the satellite.</p>
<h2 id="Investigation"><a href="#Investigation" class="headerlink" title="Investigation"></a>Investigation</h2><p>Since Orbi is OpenWRT based, I took a look at the configs<br>that potentially control the behavior and here they are:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@RBS20:/# uci show | grep WiFiLink</span><br><span class="line">...</span><br><span class="line">repacd.WiFiLink.RSSIThresholdFar='-75'</span><br><span class="line">repacd.WiFiLink.RSSIThresholdFar5g='-82'</span><br><span class="line">repacd.WiFiLink.RSSIThresholdFar24g='-76'</span><br><span class="line">repacd.WiFiLink.RSSIThresholdNear='-60'</span><br><span class="line">repacd.WiFiLink.RSSIThresholdMin='-75'</span><br><span class="line">repacd.WiFiLink.RSSIThresholdPrefer2GBackhaul='-82'</span><br><span class="line">repacd.WiFiLink.2GBackhaulSwitchDownTime='10'</span><br><span class="line">repacd.WiFiLink.MaxMeasuringStateAttempts='30'</span><br><span class="line">repacd.WiFiLink.DaisyChain='1'</span><br><span class="line">repacd.WiFiLink.RateNumMeasurements='5'</span><br><span class="line">repacd.WiFiLink.RateThresholdMin5GInPercent='35'</span><br><span class="line">repacd.WiFiLink.RateThresholdMax5GInPercent='95'</span><br><span class="line">repacd.WiFiLink.RateThresholdPrefer2GBackhaulInPercent='5'</span><br><span class="line">repacd.WiFiLink.5GBackhaulBadlinkTimeout='60'</span><br><span class="line">repacd.WiFiLink.BSSIDAssociationTimeout='170'</span><br><span class="line">repacd.WiFiLink.RateScalingFactor='85'</span><br><span class="line">repacd.WiFiLink.5GBackhaulEvalTimeShort='330'</span><br><span class="line">repacd.WiFiLink.5GBackhaulEvalTimeLong='1800'</span><br><span class="line">repacd.WiFiLink.2GBackhaulEvalTime='1800'</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>So in theory 2G backhaul should only be preferred<br>after signal drops below -82dbm or rate is below 5%/35%.<br>However in practice this almost is never the case.</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> From router side:</span></span><br><span class="line">root@RBR20:/# wlanconfig ath11 list</span><br><span class="line">ADDR               AID CHAN TXRATE RXRATE RSSI MINRSSI MAXRSSI IDLE  TXSEQ  RXSEQ  CAPS        ACAPS</span><br><span class="line"> ERP    STATE MAXRATE(DOT11) HTCAPS ASSOCTIME    IEs   MODE                   PSMODE</span><br><span class="line">                     1  157 866M    780M   51      44      58    0      0   65535   EPs         0</span><br><span class="line">   b              0           AWPSM 18:46:39     RSN WME IEEE80211_MODE_11AC_VHT80   0</span><br></pre></td></tr></table></figure>

<p>RSSI here is 51 which indicates roughly -44dbm<br>which is perfectly fine. It’s possible that the number would<br>fluctuate during operation but as you see the min value<br>is still way above the threshold. Also in practice,<br>once Orbi picks 2.4G it will stick there which doesn’t make sense<br>but since Orbi’s software isn’t open sourced there’s no way to know<br>exactly how it messes things up (looking at you Netgear developers).</p>
<h2 id="A-Hacky-Solution"><a href="#A-Hacky-Solution" class="headerlink" title="A Hacky Solution"></a>A Hacky Solution</h2><h3 id="Enable-Telnet"><a href="#Enable-Telnet" class="headerlink" title="Enable Telnet"></a>Enable Telnet</h3><p>Go to http://&lt;satellite ip&gt;/debug.htm, log in with router username &amp; password<br>and check “Enable Telnet”.</p>
<img src="/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/telnet.png">

<h3 id="Initial-Attempt"><a href="#Initial-Attempt" class="headerlink" title="Initial Attempt"></a>Initial Attempt</h3><p>Since we cannot alter Netgear’s software behavior directly,<br>we have to somehow break the 2.4G connection to force it onto 5G.</p>
<p>My initial thought was to disable the 2.4G wifi interface.<br>(Spoiler: this does not work somehow).</p>
<p>This is doable via OpenWRT’s config system.</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Show all wifi interfaces. The 2.4G is already disabled here but <span class="keyword">in</span> normal operation it will show something.</span></span><br><span class="line">root@RBS20:/# iwconfig</span><br><span class="line">ath01     IEEE 802.11b  ESSID:"NETGEAR_ORBI_hidden52"</span><br><span class="line">          Mode:Managed  Frequency:2.412 GHz  Access Point: Not-Associated</span><br><span class="line">          Bit Rate:0 kb/s   Tx-Power:25 dBm</span><br><span class="line">          RTS thr:off   Fragment thr:off</span><br><span class="line">          Power Management:off</span><br><span class="line">          Link Quality=0/94  Signal level=-95 dBm  Noise level=-95 dBm</span><br><span class="line">          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0</span><br><span class="line">          Tx excessive retries:0  Invalid misc:0   Missed beacon:0</span><br><span class="line"></span><br><span class="line">root@RBS20:/# vi /etc/config/wireless</span><br><span class="line">config wifi-iface</span><br><span class="line">        option device 'wifi0'</span><br><span class="line">        option network '0'</span><br><span class="line">        option bridge 'br0'</span><br><span class="line">        option mode 'sta'</span><br><span class="line">        option wds '1'</span><br><span class="line">        option athnewind '1'</span><br><span class="line">        option vap_ind '0'</span><br><span class="line">        option backhaul '1'</span><br><span class="line">        option wsplcd_unmanaged '1'</span><br><span class="line">        option repacd_security_unmanaged '1'</span><br><span class="line">        option dropmdns '0'</span><br><span class="line">        option ssid 'NETGEAR_ORBI_hidden52'</span><br><span class="line">        option encryption 'psk2+ccmp'</span><br><span class="line">        option ifname 'ath01'</span><br><span class="line">        option wps_config 'virtual_push_button physical_push_button'</span><br><span class="line">        option wps_pbc '1'</span><br><span class="line">        option dyn_bw_rts '0'</span><br><span class="line">        option disabled '0'</span><br></pre></td></tr></table></figure>

<p>^ From there we can see <code>ath01</code> is bound to physical interface <code>wifi0</code>.<br>We can just change the disabled value from 0 to 1.<br>Then <code>uci commit</code> will persist the value.</p>
<p>However for some reason, Orbi will restore values in OpenWRT config,<br>presumably for system integrity reason. YMMV but at least this does<br>not work for RBK20 system.</p>
<h3 id="The-Hacky-Attempt"><a href="#The-Hacky-Attempt" class="headerlink" title="The Hacky Attempt"></a>The Hacky Attempt</h3><p>While Orbi restores uci configs, it does keep its own configs<br>that are alterable via <code>config</code>.</p>
<p>Then essentially the solution becomes that we can change the 2.4G<br>backhaul SSID such that it cannot find the right one.</p>
<p>In my system the original SSID is <code>NETGEAR_ORBI_hidden52</code> from<br><code>iwconfig</code>.<br>We can grab all related configs from</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@RBS20:/# config show | grep hidden52</span><br><span class="line">wlg_ap_bh_ssid=NETGEAR_ORBI_hidden52</span><br><span class="line">wla_ap_bh_ssid=NETGEAR_ORBI_hidden52</span><br><span class="line">wla_sta_ssid=NETGEAR_ORBI_hidden52</span><br><span class="line">wlg_sta_ssid=NETGEAR_ORBI_hidden52</span><br></pre></td></tr></table></figure>

<p>Here anything starts with <code>wla</code> is 5G and <code>wlg</code> is 2.4G.</p>
<p>Then we can do</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@RBS20:/# config set wlg_sta_ssid=NETGEAR_ORBI_hidden52_disabled</span><br><span class="line">root@RBS20:/# config commit</span><br></pre></td></tr></table></figure>

<p>The <code>_disabled</code> suffix is arbitrary with the idea to prevent<br>Orbi from connecting to router via 2.4G.</p>
<p><code>wlg_ap_bh_ssid</code> does not need to be set. The <code>ap</code> setup will<br>automatically follow the <code>sta</code> setup.</p>
<p><code>nvram show | grep ssid</code> should now show the persisted value.</p>
<p>In RBS20, if you use <code>reboot</code> to restart the system,<br>it will somehow get stuck with pink led light.<br>So I always just power cycle it, which works just fine.</p>
<p>To confirm this works, on satellite side, once restarted,<br><code>iwconfig</code> should show the new SSID and signal strength should be<br>-95dbm indicating it’s disconnected.</p>
<p>Enable Telnet in router and log into it. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ath01 is 2.4G wifi interface. It should have nothing connected now.</span><br><span class="line">root@RBR20:/# wlanconfig ath01 list</span><br><span class="line"># ath11 is 5G. It should have satellite(s) connected.</span><br><span class="line">root@RBR20:/# wlanconfig ath11 list</span><br><span class="line">ADDR               AID CHAN TXRATE RXRATE RSSI MINRSSI MAXRSSI IDLE  TXSEQ  RXSEQ  CAPS        ACAPS</span><br><span class="line"> ERP    STATE MAXRATE(DOT11) HTCAPS ASSOCTIME    IEs   MODE                   PSMODE</span><br><span class="line">                     1  157 866M    780M   51      44      58    0      0   65535   EPs         0</span><br><span class="line">   b              0           AWPSM 19:26:27     RSN WME IEEE80211_MODE_11AC_VHT80   0</span><br></pre></td></tr></table></figure>


            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/wifi-openwrt/">wifi, openwrt</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/05/23/Why-Keeping-High-Standard-of-Shit-Is-Important/"
                    data-tooltip="Why Keeping High Standards of Shit Is Important"
                    aria-label="PREVIOUS: Why Keeping High Standards of Shit Is Important"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/"
                    data-tooltip="Monitor gRPC Microservices in Kubernetes with Amazon X-Ray"
                    aria-label="NEXT: Monitor gRPC Microservices in Kubernetes with Amazon X-Ray"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Shawn Xu. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/05/23/Why-Keeping-High-Standard-of-Shit-Is-Important/"
                    data-tooltip="Why Keeping High Standards of Shit Is Important"
                    aria-label="PREVIOUS: Why Keeping High Standards of Shit Is Important"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/11/25/Monitor-gRPC-Microservices-in-Kubernetes-with-Amazon-X-Ray/"
                    data-tooltip="Monitor gRPC Microservices in Kubernetes with Amazon X-Ray"
                    aria-label="NEXT: Monitor gRPC Microservices in Kubernetes with Amazon X-Ray"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://miro.medium.com/fit/c/90/90/1*7cPXDgvy2_tKMHR4SEd-yQ.jpeg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Shawn Xu</h4>
        
            <div id="about-card-bio"><p>Software Engineer in Bay Area</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-a5wszscostah6olx2wgfq7mglfmluysmmlvnxgmmszk3gwouxhlbwbsk0xkf.min.js"></script>
<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://xunnanxu.github.io/2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/';
              
            this.page.identifier = '2020/04/04/Make-Wireless-BackHaul-Great-Again-Disable-Orbi-2-4G-Backhaul/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'xcorpion';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
